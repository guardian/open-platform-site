!function(e){var t={};function i(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function l(){var e=require("util");return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}t.mk_block=function(e,t,n){1===arguments.length&&(t="\n\n");var r=new String(e);return r.trailing=t,r.inspect=l,r.toSource=i,void 0!==n&&(r.lineNumber=n),r};function n(e){switch(typeof e){case"undefined":this.dialect=n.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in n.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=n.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""}var s=t.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},v=(Array.prototype.forEach?t.forEach=function(e,t,n){return e.forEach(t,n)}:t.forEach=function(e,t,n){for(var r=0;r<e.length;r++)t.call(n||e,e[r],r,e)},t.isEmpty=function(e){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0},t.extract_attr=function(e){return s(e)&&1<e.length&&"object"==typeof e[1]&&!s(e[1])?e[1]:void 0},n.dialects={},n.mk_block=t.mk_block),s=t.isArray;function a(e){for(var t=0,n=-1;-1!==(n=e.indexOf("\n",n+1));)t++;return t}n.parse=function(e,t){return new n(t).toTree(e)},n.prototype.split_blocks=function(e){e=e.replace(/(\r\n|\n|\r)/g,"\n");var t,n=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,r=[],i=1;for(null!==(t=/^(\s*\n)/.exec(e))&&(i+=a(t[0]),n.lastIndex=t[0].length);null!==(t=n.exec(e));)"\n#"===t[2]&&(t[2]="\n",n.lastIndex--),r.push(v(t[1],t[2],i)),i+=a(t[0]);return r},n.prototype.processBlock=function(e,t){var n=this.dialect.block,r=n.__order__;if("__call__"in n)return n.__call__.call(this,e,t);for(var i=0;i<r.length;i++){var l=n[r[i]].call(this,e,t);if(l)return(!s(l)||0<l.length&&!s(l[0]))&&this.debug(r[i],"didn't return a proper array"),l}return[]},n.prototype.processInline=function(e){return this.dialect.inline.__call__.call(this,String(e))},n.prototype.toTree=function(e,t){var n=e instanceof Array?e:this.split_blocks(e),e=this.tree;try{for(this.tree=t||this.tree||["markdown"];n.length;){var r=this.processBlock(n.shift(),n);r.length&&this.tree.push.apply(this.tree,r)}return this.tree}finally{t&&(this.tree=e)}},n.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,e),"undefined"!=typeof console&&void 0!==console.log&&console.log.apply(null,e)},n.prototype.loop_re_over_block=function(e,t,n){for(var r,i=t.valueOf();i.length&&null!==(r=e.exec(i));)i=i.substr(r[0].length),n.call(this,r);return i},n.buildBlockOrder=function(e){var t,n=[];for(t in e)"__order__"!==t&&"__call__"!==t&&n.push(t);e.__order__=n},n.buildInlinePatterns=function(e){var t,n,r=[];for(t in e)t.match(/^__.*__$/)||(n=t.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n"),r.push(1===t.length?n:"(?:"+n+")"));r=r.join("|"),e.__patterns__=r;var i=e.__call__;e.__call__=function(e,t){return void 0!==t?i.call(this,e,t):i.call(this,e,r)}};var h=t.extract_attr;function c(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function o(e){if("string"==typeof e)return c(e);var t=e.shift(),n={},r=[];for(!e.length||"object"!=typeof e[0]||e[0]instanceof Array||(n=e.shift());e.length;)r.push(o(e.shift()));var i,l="";for(i in n)l+=" "+i+'="'+c(n[i])+'"';return"img"===t||"br"===t||"hr"===t?"<"+t+l+"/>":"<"+t+l+">"+r.join("")+"</"+t+">"}n.renderJsonML=function(e,t){(t=t||{}).root=t.root||!1;var n=[];if(t.root)n.push(o(e));else for(e.shift(),!e.length||"object"!=typeof e[0]||e[0]instanceof Array||e.shift();e.length;)n.push(o(e.shift()));return n.join("\n\n")},n.toHTMLTree=function(e,t,n){"string"==typeof e&&(e=this.parse(e,t));var t=h(e),r={},e=function e(t,n,r){r=r||{};var i=t.slice(0);"function"==typeof r.preprocessTreeNode&&(i=r.preprocessTreeNode(i,n));var l=h(i);if(l){for(var s in i[1]={},l)i[1][s]=l[s];l=i[1]}if("string"==typeof i)return i;switch(i[0]){case"header":i[0]="h"+i[1].level,delete i[1].level;break;case"bulletlist":i[0]="ul";break;case"numberlist":i[0]="ol";break;case"listitem":i[0]="li";break;case"para":i[0]="p";break;case"markdown":i[0]="html",l&&delete l.references;break;case"code_block":i[0]="pre",s=l?2:1;var a=["code"];a.push.apply(a,i.splice(s,i.length-s)),i[s]=a;break;case"inlinecode":i[0]="code";break;case"img":i[1].src=i[1].href,delete i[1].href;break;case"linebreak":i[0]="br";break;case"link":i[0]="a";break;case"link_ref":if(i[0]="a",!(c=n[l.ref]))return l.original;delete l.ref,l.href=c.href,c.title&&(l.title=c.title),delete l.original;break;case"img_ref":var c;if(i[0]="img",!(c=n[l.ref]))return l.original;delete l.ref,l.src=c.href,c.title&&(l.title=c.title),delete l.original}s=1;if(l){for(var o in i[1]){s=2;break}1===s&&i.splice(s,1)}for(;s<i.length;++s)i[s]=e(i[s],n,r);return i}(e,r=t&&t.references?t.references:r,n);return function e(t){var n=h(t)?2:1;for(;n<t.length;)"string"==typeof t[n]?n+1<t.length&&"string"==typeof t[n+1]?t[n]+=t.splice(n+1,1)[0]:++n:(e(t[n]),++n)}(e),e},n.toHTML=function(e,t,n){e=this.toHTMLTree(e,t,n);return this.renderJsonML(e)};var m,k,y,w,r={inline_until_char:function(e,t){for(var n=0,r=[];;){if(e.charAt(n)===t)return[++n,r];if(n>=e.length)return null;var i=this.dialect.inline.__oneElement__.call(this,e.substr(n));n+=i[0],r.push.apply(r,i.slice(1))}},subclassDialect:function(e){function t(){}function n(){}return t.prototype=e.block,n.prototype=e.inline,{block:new t,inline:new n}}},$=t.forEach,h=t.extract_attr,v=t.mk_block,u=t.isEmpty,f=r.inline_until_char,p={block:{atxHeader:function(e,t){var n,r=e.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(r)return n=["header",{level:r[1].length}],Array.prototype.push.apply(n,this.processInline(r[2])),r[0].length<e.length&&t.unshift(v(e.substr(r[0].length),e.trailing,e.lineNumber+2)),[n]},setextHeader:function(e,t){var n,r=e.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(r)return n=["header",{level:"="===r[2]?1:2},r[1]],r[0].length<e.length&&t.unshift(v(e.substr(r[0].length),e.trailing,e.lineNumber+2)),[n]},code:function(e,t){var n=[],r=/^(?: {0,3}\t| {4})(.*)\n?/;if(e.match(r)){for(;;){var i=this.loop_re_over_block(r,e.valueOf(),function(e){n.push(e[1])});if(i.length){t.unshift(v(i,e.trailing));break}if(!t.length)break;if(!t[0].match(r))break;n.push(e.trailing.replace(/[^\n]/g,"").substring(2)),e=t.shift()}return[["code_block",n.join("\n")]]}},horizRule:function(e,t){var n,r,i=e.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(i)return n=[["hr"]],i[1]&&(r=v(i[1],"",e.lineNumber),n.unshift.apply(n,this.toTree(r,[]))),i[3]&&t.unshift(v(i[3],e.trailing,e.lineNumber+1)),n},lists:(m="[*+-]|\\d+\\.",k=/[*+-]/,y=new RegExp("^( {0,3})("+m+")[ \t]+"),w="(?: {0,3}\\t| {4})",function(e,t){if(u=e.match(y)){for(var n,r=[],i=b(u),l=!1,s=[r[0].list];;){for(var a=e.split(/(?=\n)/),c="",o="",h=0;h<a.length;h++){var u,o="",f=a[h].replace(/^\n/,function(e){return o=e,""}),p=(p=r.length,new RegExp("(?:^("+w+"{0,"+p+"} {0,3})("+m+")\\s+)|(^"+w+"{0,"+(p-1)+"}[ ]{0,4})"));if(void 0!==(u=f.match(p))[1]){c.length&&(x(n,l,this.processInline(c),o),l=!1,c=""),u[1]=u[1].replace(/ {0,3}\t/g,"    ");p=Math.floor(u[1].length/4)+1;if(p>r.length)i=b(u),n.push(i),n=i[1]=["listitem"];else{for(var g=!1,_=0;_<r.length;_++)if(r[_].indent===u[1]){i=r[_].list,r.splice(_+1,r.length-(_+1)),g=!0;break}g||(++p<=r.length?(r.splice(p,r.length-p),i=r[p-1].list):(i=b(u),n.push(i))),i.push(n=["listitem"])}o=""}f.length>u[0].length&&(c+=o+f.substr(u[0].length))}c.length&&(x(n,l,this.processInline(c),o),l=!1,c="");var d=function(e,t){for(var n=new RegExp("^("+w+"{"+e+"}.*?\\n?)*$"),r=new RegExp("^"+w+"{"+e+"}","gm"),i=[];0<t.length&&n.exec(t[0]);){var l=t.shift(),s=l.replace(r,"");i.push(v(s,l.trailing,l.lineNumber))}return i}(r.length,t),d=(0<d.length&&($(r,M,this),n.push.apply(n,this.toTree(d,[]))),t[0]&&t[0].valueOf()||"");if(!d.match(y)&&!d.match(/^ /))break;e=t.shift();d=this.dialect.block.horizRule(e,t);if(d){s.push.apply(s,d);break}$(r,M,this),l=!0}return s}function b(e){var t=k.exec(e[2])?["bulletlist"]:["numberlist"];return r.push({list:t,indent:e[1]}),t}}),blockquote:function(e,t){if(e.match(/^>/m)){var n=[];if(">"!==e[0]){for(var r=e.split(/\n/),i=[],l=e.lineNumber;r.length&&">"!==r[0][0];)i.push(r.shift()),l++;var s=v(i.join("\n"),"\n",e.lineNumber);n.push.apply(n,this.processBlock(s,[])),e=v(r.join("\n"),e.trailing,l)}for(;t.length&&">"===t[0][0];){var a=t.shift();e=v(e+e.trailing+a,a.trailing,e.lineNumber)}var s=e.replace(/^> ?/gm,""),s=(this.tree,this.toTree(s,["blockquote"])),c=h(s);return c&&c.references&&(delete c.references,u(c)&&s.splice(1,1)),n.push(s),n}},referenceDefn:function(e,t){var n,r=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(e.match(r))return h(this.tree)||this.tree.splice(1,0,{}),void 0===(n=h(this.tree)).references&&(n.references={}),(r=this.loop_re_over_block(r,e,function(e){e[2]&&"<"===e[2][0]&&">"===e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1));var t=n.references[e[1].toLowerCase()]={href:e[2]};void 0!==e[4]?t.title=e[4]:void 0!==e[5]&&(t.title=e[5])})).length&&t.unshift(v(r,e.trailing)),[]},para:function(e){return[["para"].concat(this.processInline(e))]}},inline:{__oneElement__:function(e,t,n){var r;return t=t||this.dialect.inline.__patterns__,(t=new RegExp("([\\s\\S]*?)("+(t.source||t)+")").exec(e))?t[1]?[t[1].length,t[1]]:(r=t[2]in this.dialect.inline?this.dialect.inline[t[2]].call(this,e.substr(t.index),t,n||[]):r)||[t[2].length,t[2]]:[e.length,e]},__call__:function(e,t){var n,r=[];function i(e){"string"==typeof e&&"string"==typeof r[r.length-1]?r[r.length-1]+=e:r.push(e)}for(;0<e.length;)n=this.dialect.inline.__oneElement__.call(this,e,t,r),e=e.substr(n.shift()),$(n,i);return r},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(e){return this.dialect.inline.__escape__.exec(e)?[2,e.charAt(1)]:[1,"\\"]},"![":function(e){var t,n=e.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);return n?(n[2]&&"<"===n[2][0]&&">"===n[2][n[2].length-1]&&(n[2]=n[2].substring(1,n[2].length-1)),n[2]=this.dialect.inline.__call__.call(this,n[2],/\\/)[0],t={alt:n[1],href:n[2]||""},void 0!==n[4]&&(t.title=n[4]),[n[0].length,["img",t]]):(n=e.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/))?[n[0].length,["img_ref",{alt:n[1],ref:n[2].toLowerCase(),original:n[0]}]]:[2,"!["]},"[":function(e){var t=String(e),n=f.call(this,e.substr(1),"]");if(!n)return[1,"["];var r,i=1+n[0],n=n[1],l=(e=e.substr(i)).match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(l){var s=l[1];if(i+=l[0].length,s&&"<"===s[0]&&">"===s[s.length-1]&&(s=s.substring(1,s.length-1)),!l[3])for(var a=1,c=0;c<s.length;c++)switch(s[c]){case"(":a++;break;case")":0==--a&&(i-=s.length-c,s=s.substring(0,c))}return r={href:(s=this.dialect.inline.__call__.call(this,s,/\\/)[0])||""},void 0!==l[3]&&(r.title=l[3]),[i,["link",r].concat(n)]}return(l=e.match(/^\s*\[(.*?)\]/))?[i+=l[0].length,["link_ref",r={ref:(l[1]||String(n)).toLowerCase(),original:t.substr(0,i)}].concat(n)]:1===n.length&&"string"==typeof n[0]?[i,["link_ref",r={ref:n[0].toLowerCase(),original:t.substr(0,i)},n[0]]]:[1,"["]},"<":function(e){return null!==(e=e.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?e[3]?[e[0].length,["link",{href:"mailto:"+e[3]},e[3]]]:"mailto"===e[2]?[e[0].length,["link",{href:e[1]},e[1].substr("mailto:".length)]]:[e[0].length,["link",{href:e[1]},e[1]]]:[1,"<"]},"`":function(e){e=e.match(/(`+)(([\s\S]*?)\1)/);return e&&e[2]?[e[1].length+e[2].length,["inlinecode",e[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}}};function x(e,t,n,r){if(t)e.push(["para"].concat(n));else{var i=e[e.length-1]instanceof Array&&"para"===e[e.length-1][0]?e[e.length-1]:e;r&&1<e.length&&n.unshift(r);for(var l=0;l<n.length;l++){var s=n[l];"string"==typeof s&&1<i.length&&"string"==typeof i[i.length-1]?i[i.length-1]+=s:i.push(s)}}}function M(e,t,n){e=e.list,e=e[e.length-1];e[1]instanceof Array&&"para"===e[1][0]||(t+1===n.length?e.push(["para"].concat(e.splice(1,e.length-1))):(t=e.pop(),e.push(["para"].concat(e.splice(1,e.length-1)),t)))}function g(l,s){var a=l+"_state",c="strong"===l?"em_state":"strong_state";function o(e){this.len_after=e,this.name="close_"+s}return function(e){var t,n,r,i;return this[a][0]===s?(this[a].shift(),[e.length,new o(e.length-s.length)]):(t=this[c].slice(),n=this[a].slice(),this[a].unshift(s),i=(r=this.processInline(e.substr(s.length)))[r.length-1],this[a].shift(),i instanceof o?(r.pop(),[e.length-i.len_after,[l].concat(r)]):(this[c]=t,this[a]=n,[s.length,s]))}}p.inline["**"]=g("strong","**"),p.inline.__=g("strong","__"),p.inline["*"]=g("em","*"),p.inline._=g("em","_"),n.dialects.Gruber=p,n.buildBlockOrder(n.dialects.Gruber.block),n.buildInlinePatterns(n.dialects.Gruber.inline);r=r.subclassDialect(p),h=t.extract_attr,$=t.forEach;r.processMetaHash=function(e){for(var t,n=function(e){var t=e.split(""),n=[""],r=!1;for(;t.length;){var i=t.shift();switch(i){case" ":r?n[n.length-1]+=i:n.push("");break;case"'":case'"':r=!r;break;case"\\":i=t.shift();default:n[n.length-1]+=i}}return n}(e),r={},i=0;i<n.length;++i)/^#/.test(n[i])?r.id=n[i].substring(1):/^\./.test(n[i])?r.class=r.class?r.class+n[i].replace(/./," "):n[i].substring(1):/\=/.test(n[i])&&(r[(t=n[i].split(/\=/))[0]]=t[1]);return r},r.block.document_meta=function(e){if(!(1<e.lineNumber)&&e.match(/^(?:\w+:.*\n)*\w+:.*$/)){h(this.tree)||this.tree.splice(1,0,{});var t,n=e.split(/\n/);for(t in n){var r=n[t].match(/(\w+):\s*(.*)$/),i=r[1].toLowerCase(),r=r[2];this.tree[1][i]=r}return[]}},r.block.block_meta=function(e){var t=e.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(t){var n=this.dialect.processMetaHash(t[2]);if(""===t[1]){var t=this.tree[this.tree.length-1],r=h(t);if("string"==typeof t)return;for(i in r||t.splice(1,0,r={}),n)r[i]=n[i];return[]}var i,t=e.replace(/\n.*$/,""),e=this.processBlock(t,[]);for(i in(r=h(e[0]))||e[0].splice(1,0,r={}),n)r[i]=n[i];return e}},r.block.definition_list=function(e,t){var n=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,r=["dl"];if(s=e.match(n)){for(var i=[e];t.length&&n.exec(t[0]);)i.push(t.shift());for(var l=0;l<i.length;++l){for(var s,a=(s=i[l].match(n))[1].replace(/\n$/,"").split(/\n/),c=s[2].split(/\n:\s+/),o=0;o<a.length;++o)r.push(["dt",a[o]]);for(o=0;o<c.length;++o)r.push(["dd"].concat(this.processInline(c[o].replace(/(\n)\s+/,"$1"))))}return[r]}},r.block.table=function(e){function n(e,t){(t=t||"\\s").match(/^[\\|\[\]{}?*.+^$]$/)&&(t="\\"+t);for(var n,r=[],i=new RegExp("^((?:\\\\.|[^\\\\"+t+"])*)"+t+"(.*)");n=e.match(i);)r.push(n[1]),e=n[2];return r.push(e),r}var r,t;if(t=e.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))t[3]=t[3].replace(/^\s*\|/gm,"");else if(!(t=e.match(/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/)))return;var i=["table",["thead",["tr"]],["tbody"]],l=(t[2]=t[2].replace(/\|\s*$/,"").split("|"),[]);for($(t[2],function(e){e.match(/^\s*-+:\s*$/)?l.push({align:"right"}):e.match(/^\s*:-+\s*$/)?l.push({align:"left"}):e.match(/^\s*:-+:\s*$/)?l.push({align:"center"}):l.push({})}),t[1]=n(t[1].replace(/\|\s*$/,""),"|"),r=0;r<t[1].length;r++)i[1][1].push(["th",l[r]||{}].concat(this.processInline(t[1][r].trim())));return $(t[3].replace(/\|\s*$/gm,"").split("\n"),function(e){var t=["tr"];for(e=n(e,"|"),r=0;r<e.length;r++)t.push(["td",l[r]||{}].concat(this.processInline(e[r].trim())));i[2].push(t)},this),[i]},r.inline["{:"]=function(e,t,n){if(!n.length)return[2,"{:"];n=n[n.length-1];if("string"==typeof n)return[2,"{:"];e=e.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!e)return[2,"{:"];var r,i=this.dialect.processMetaHash(e[1]),l=h(n);for(r in l||n.splice(1,0,l={}),i)l[r]=i[r];return[e[0].length,""]},n.dialects.Maruku=r,n.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,n.buildBlockOrder(n.dialects.Maruku.block),n.buildInlinePatterns(n.dialects.Maruku.inline),e.Markdown=n,e.parse=n.parse,e.toHTML=n.toHTML,e.toHTMLTree=n.toHTMLTree,e.renderJsonML=n.renderJsonML}((window.markdown={},window.markdown));